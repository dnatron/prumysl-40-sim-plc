JistÄ›! NÃ­Å¾e je **plnohodnotnÃ½, detailnÃ­ prompt pro vÃ½voj simulÃ¡toru PLC strojÅ¯**, kterÃ½ mÅ¯Å¾eÅ¡ pouÅ¾Ã­t jako specifikaci pro sebe, tÃ½m nebo i pro AI asistenta (napÅ™. pÅ™i generovÃ¡nÃ­ kÃ³du). Prompt zahrnuje cÃ­le, technologickÃ½ stack, architektonickÃ© poÅ¾adavky, uÅ¾ivatelskÃ© scÃ©nÃ¡Å™e a omezenÃ­.

--- 

### ğŸ§  **Prompt: VÃ½voj webovÃ©ho simulÃ¡toru prÅ¯myslovÃ½ch PLC strojÅ¯ pro Industry 4.0**

VytvoÅ™ **plnÄ› funkÄnÃ­ webovÃ½ simulÃ¡tor prÅ¯myslovÃ½ch PLC strojÅ¯**, kterÃ½ umoÅ¾nÃ­ uÅ¾ivatelÅ¯m definovat virtuÃ¡lnÃ­ vÃ½robnÃ­ zaÅ™Ã­zenÃ­ a vystavovat jejich data prostÅ™ednictvÃ­m standardnÃ­ch prÅ¯myslovÃ½ch protokolÅ¯ â€“ konkrÃ©tnÄ› **OPC UA** a **Modbus TCP**.

#### ğŸ”§ **TechnologickÃ½ stack**
- **Backend**: Python 3.12 + FastAPI
- **ORM/DatovÃ½ model**: SQLModel
- **DatabÃ¡ze (pro metadata)**: SQLite (soubor `config.sqlite`)
- **Frontend**: Jinja2 (Å¡ablony), Bootstrap 5 (styly), HTMX (dynamickÃ© interakce bez JavaScript frameworku)
- **Protokoly**:
  - OPC UA server: knihovna `opcua` (freeopcua) nebo `opcua-asyncio`
  - Modbus TCP server: knihovna `pymodbus` (verze â‰¥3.0, asyncio reÅ¾im)

#### ğŸ¯ **HlavnÃ­ cÃ­le**
1. UmoÅ¾nit uÅ¾ivateli pÅ™es webovÃ© rozhranÃ­ **pÅ™idat, upravit, spustit a zastavit** simulaci jednoho nebo vÃ­ce PLC strojÅ¯.
2. Pro kaÅ¾dÃ½ stroj specifikovat:
   - NÃ¡zev (napÅ™. â€Lis-01â€œ)
   - Protokol: **OPC UA** nebo **Modbus TCP**
   - IP adresa (vÃ½chozÃ­: `127.0.0.1`)
   - Port (vÃ½chozÃ­: `4840` pro OPC UA, `5020` pro Modbus)
3. Pro kaÅ¾dÃ½ stroj definovat seznam **senzorÅ¯/tagÅ¯** se:
   - JmÃ©no (napÅ™. â€Teplota motoruâ€œ)
   - DatovÃ½ typ (`float`, `int`, `bool`)
   - PoÄÃ¡teÄnÃ­ hodnotou
   - MinimÃ¡lnÃ­ a maximÃ¡lnÃ­ hodnotou (pro simulaci nÃ¡hodnÃ½ch zmÄ›n)
4. PÅ™i spuÅ¡tÄ›nÃ­ simulace:
   - Pokud je protokol **OPC UA**, spustÃ­ se **lokÃ¡lnÃ­ OPC UA server** na zadanÃ©m portu, kterÃ½ vystavuje strom:  
     `Root â†’ Objects â†’ Machines â†’ {nÃ¡zev_stroje} â†’ {jmÃ©no_senzoru}`
   - Pokud je protokol **Modbus TCP**, spustÃ­ se **Modbus TCP server**, kterÃ½ mapuje senzory na **holding registry** (po Å™adÄ›: 0, 1, 2â€¦)
   - Hodnoty senzorÅ¯ se **dynamicky mÄ›nÃ­** (napÅ™. nÃ¡hodnÄ› v rÃ¡mci min/max rozsahu nebo s trendem)
5. Zobrazit v UI stav kaÅ¾dÃ© simulace: **BÄ›Å¾Ã­ / Zastaveno / Chyba**

#### ğŸ–¥ï¸ **PoÅ¾adavky na webovÃ© rozhranÃ­**
- **Dashboard**: pÅ™ehled vÅ¡ech strojÅ¯ s akcemi (Spustit, Zastavit, Upravit, Smazat)
- **FormulÃ¡Å™ pro pÅ™idÃ¡nÃ­/editaci**:
  - Volba protokolu (OPC UA / Modbus) â†’ po vÃ½bÄ›ru se **dynamicky naÄtou odpovÃ­dajÃ­cÃ­ pole** pomocÃ­ HTMX
  - MoÅ¾nost pÅ™idÃ¡vat/odebÃ­rat senzory v rÃ¡mci jednoho formulÃ¡Å™e (pomocÃ­ HTMX nebo jednoduchÃ©ho repeatable pole)
- **Reaktivita**: Å¾Ã¡dnÃ½ full-page reload; vÅ¡e pÅ™es HTMX (`hx-post`, `hx-get`, `hx-target`)
- **Styl**: ÄistÃ©, profesionÃ¡lnÃ­ â€“ pouÅ¾Ã­t Bootstrap 5, mobile-first

#### âš™ï¸ **ArchitektonickÃ© poÅ¾adavky**
- OddÄ›lit **konfiguraÄnÃ­ data** (uloÅ¾enÃ¡ v `config.sqlite` pÅ™es SQLModel) od **simulaÄnÃ­ logiky**
- KaÅ¾dÃ¡ simulace bÄ›Å¾Ã­ **nezÃ¡visle** (v samostatnÃ©m asyncio tasku nebo threadu s daemon=True)
- Zajistit **uvolnÄ›nÃ­ portu** pÅ™i zastavenÃ­ simulace
- Implementovat zÃ¡kladnÃ­ **sprÃ¡vu chyb** (napÅ™. port jiÅ¾ pouÅ¾Ã­vÃ¡n â†’ zobrazit chybovou hlÃ¡Å¡ku v UI)
- KÃ³d musÃ­ bÃ½t **modulÃ¡rnÃ­**: `opc_sim.py`, `modbus_sim.py`, `simulation_manager.py`

#### ğŸ“¦ **SloÅ¾kovÃ¡ struktura**
```
plc-simulator/
â”‚
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ main.py                 # HlavnÃ­ FastAPI aplikace: routy pro UI (HTMX), API pro sprÃ¡vu simulacÃ­
â”‚   â”œâ”€â”€ models.py               # SQLModel definice: Machine, Sensor
â”‚   â”œâ”€â”€ opc_sim.py              # TÅ™Ã­da/async funkce pro spuÅ¡tÄ›nÃ­ OPC UA serveru (python-opcua)
â”‚   â”œâ”€â”€ modbus_sim.py           # TÅ™Ã­da/async funkce pro spuÅ¡tÄ›nÃ­ Modbus TCP serveru (pymodbus)
â”‚   â””â”€â”€ simulation_manager.py   # SprÃ¡va bÄ›Å¾Ã­cÃ­ch simulacÃ­: start/stop, sledovÃ¡nÃ­ stavu, uvolnÄ›nÃ­ portÅ¯
â”‚
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ templates/
â”‚   â”‚   â”œâ”€â”€ base.html           # ZÃ¡kladnÃ­ HTML Å¡ablona s Bootstrap + HTMX
â”‚   â”‚   â”œâ”€â”€ dashboard.html      # PÅ™ehled vÅ¡ech PLC strojÅ¯, akce (spustit, zastavit, upravit)
â”‚   â”‚   â””â”€â”€ machine_form.html   # FormulÃ¡Å™ pro vytvoÅ™enÃ­/Ãºpravu stroje + dynamickÃ© senzory
â”‚   â”‚
â”‚   â””â”€â”€ static/
â”‚       â””â”€â”€ style.css           # (VolitelnÃ©) vlastnÃ­ styly â€“ jinak staÄÃ­ Bootstrap
â”‚
â”œâ”€â”€ config.sqlite               # SQLite databÃ¡ze â€“ uklÃ¡dÃ¡ jen konfiguraci (stroje, senzory), NE mÄ›Å™enÃ­
â”œâ”€â”€ requirements.txt            # ZÃ¡vislosti: fastapi, uvicorn, sqlmodel, opcua, pymodbus, jinja2, httptools...
â””â”€â”€ README.md                   # KrÃ¡tkÃ½ nÃ¡vod: jak spustit, jak pÅ™ipojit OPC klienta atd.

#### ğŸš« **OmezenÃ­ / NepotÅ™ebnÃ© prvky**
- Å½Ã¡dnÃ© ovÄ›Å™ovÃ¡nÃ­ uÅ¾ivatele (auth) â€“ aplikace bÄ›Å¾Ã­ lokÃ¡lnÄ› pro vÃ½voj
- Å½Ã¡dnÃ© uklÃ¡dÃ¡nÃ­ historie mÄ›Å™enÃ­ â€“ simulÃ¡tor pouze **vystavuje data**, neuklÃ¡dÃ¡ je
- NepotÅ™eba podpora vÃ­ce uÅ¾ivatelÅ¯ ani multi-tenant reÅ¾imu

#### âœ… **KritÃ©rium ÃºspÄ›chu**
- UÅ¾ivatel pÅ™idÃ¡ stroj â€ÄŒerpadlo-01â€œ s protokolem OPC UA a senzorem â€Tlakâ€œ (float, 0â€“10 bar)
- Klikne na â€Spustitâ€œ â†’ v UI se zobrazÃ­ â€BÄ›Å¾Ã­â€œ
- PÅ™ipojÃ­ externÃ­ OPC UA klient (napÅ™. UaExpert) k `opc.tcp://127.0.0.1:4840`
- VidÃ­ strom a mÄ›nÃ­cÃ­ se hodnotu tlaku v reÃ¡lnÃ©m Äase
- TotÃ©Å¾ funguje pro Modbus (ovÄ›Å™eno nÃ¡strojem jako `mbpoll` nebo `QModMaster`)

